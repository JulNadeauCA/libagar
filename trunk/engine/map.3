.\"	$Csoft: map.3,v 1.9 2002/09/01 08:56:53 vedge Exp $
.\"
.\" Copyright (c) 2001, 2002 CubeSoft Communications, Inc.
.\" All rights reserved.
.\"
.\" Redistribution and use in source and binary forms, with or without
.\" modification, are permitted provided that the following conditions
.\" are met:
.\" 1. Redistribution of source code must retain the above copyright
.\"    notice, this list of conditions and the following disclaimer.
.\" 2. Neither the name of CubeSoft Communications, nor the names of its
.\"    contributors may be used to endorse or promote products derived from
.\"    this software without specific prior written permission.
.\" 
.\" THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR
.\" IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
.\" WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
.\" ARE DISCLAIMED. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT,
.\" INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
.\" (INCLUDING BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
.\" SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
.\" HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT,
.\" STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING
.\" IN ANY WAY OUT OF THE USE OF THIS SOFTWARE EVEN IF ADVISED OF THE
.\" POSSIBILITY OF SUCH DAMAGE.
.\"
.\"	$OpenBSD: mdoc.template,v 1.6 2001/02/03 08:22:44 niklas Exp $
.\"
.Dd JANUARY 30, 2002
.Dt MAP 3
.Os
.Sh NAME
.Nm map
.Nd agar map
.Sh SYNOPSIS
.Fd #include <engine/map.h>
.Sh DESCRIPTION
An agar map is an array of node structures.
Each node may contain a stack of node reference structures,
which point to arbitrary structures and an offset within them.
Flags may alter the meaning of the offset.
.Pp
.Sh INITIALIZATION
.nr nS 1
.Ft "struct map *"
.Fn map_init "struct map *m" "char *name" "char *media" "Uint32 flags"
.Pp
.Ft void
.Fn map_destroy "struct map *map"
.Pp
.Ft int
.Fn map_load "struct map *map" "int fd"
.Pp
.Ft int
.Fn map_save "struct map *map" "int fd"
.Pp
.Ft void
.Fn map_clean "struct map *map" "struct object *ob" "Uint32 offs" \
              "Uint32 nflags" "Uint32 rflags"
.Pp
.Ft void
.Fn map_allocnodes "struct map *map" "Uint32 w" "Uint32 h"
.Pp
.Ft void
.Fn map_freenodes "struct map *map"
.nr nS 0
.Pp
The
.Fn map_init
function initializes a map identified by the string
.Fa name .
The
.Fa media
argument, if non-null, specifies an archive from which to load audio and
video data.
The
.Fa flags
argument is currently ignored.
.Pp
The
.Fn map_destroy
function frees resources allocated by a map.
.Pp
The
.Fn map_load
function loads a map from file descriptor
.Fa fd .
The
.Fn map_save
function saves a map to file descriptor
.Fa fd .
The world must be locked, and the map must not be locked by the caller thread
when
.Fn map_load
and
.Fn map_save
are called.
.Pp
The
.Fn map_clean
function reinitializes all nodes on
.Fa map
and add a reference to offset
.Fa offs
of object
.Fa ob
with the node flags set to
.Fa nflags
and the node reference flags set to
.Fa rflags .
.Fn map_clean
must be called when the map
.Fa m
is locked.
.Pp
The
.Fn map_allocnodes
function allocates
.Fa w
x
.Fa h
nodes.
The
.Fn map_freenodes
function releases nodes allocated for map
.Fa map .
The map must be locked when
.Fn map_allocnodes
or
.Fn map_freenodes
is called.
.Sh SEE ALSO
.Xr agar 3
