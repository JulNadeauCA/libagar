.\"	$Csoft: mapview.3,v 1.27 2003/06/13 22:45:05 vedge Exp $
.\"
.\" Copyright (c) 2002, 2003 CubeSoft Communications, Inc.
.\" <http://www.csoft.org>
.\" All rights reserved.
.\"
.\" Redistribution and use in source and binary forms, with or without
.\" modification, are permitted provided that the following conditions
.\" are met:
.\" 1. Redistributions of source code must retain the above copyright
.\"    notice, this list of conditions and the following disclaimer.
.\" 2. Redistributions in binary form must reproduce the above copyright
.\"    notice, this list of conditions and the following disclaimer in the
.\"    documentation and/or other materials provided with the distribution.
.\" 
.\" THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR
.\" IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
.\" WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
.\" ARE DISCLAIMED. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT,
.\" INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
.\" (INCLUDING BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
.\" SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
.\" HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT,
.\" STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING
.\" IN ANY WAY OUT OF THE USE OF THIS SOFTWARE EVEN IF ADVISED OF THE
.\" POSSIBILITY OF SUCH DAMAGE.
.\"
.Dd August 20, 2002
.Dt MAPEDIT 3
.Os
.ds vT Agar API Reference
.ds oS Agar 1.0
.Sh NAME
.Nm mapview
.Nd agar level display/edition widget
.Sh SYNOPSIS
.Bd -literal
#include <engine/mapedit/mapview.h>
.Ed
.Sh DESCRIPTION
The
.Nm
widget displays
.Xr map 3
structures.
.Sh INITIALIZATION
.nr nS 1
.Ft struct mapview *
.Fn mapview_new "void *parent" "struct map *map" "int flags"
.Pp
.Ft void
.Fn mapview_init "struct mapview *mv" "struct map *map" "int flags"
.Pp
.Ft void
.Fn mapview_prescale "struct mapview *mv" "int w" "int h"
.Pp
.Ft void
.Fn mapview_center "struct mapview *mv" "int x" "int y"
.Pp
.Ft int
.Fn mapview_zoom "struct mapview *mv" "int zoom"
.nr nS 0
.Pp
The
.Fn mapview_new
function allocates, initializes, and attaches a
.Nm
widget.
The
.Fn mapview_init
function initializes a
.Nm
widget to display
.Fa map .
The
.Fa flags
may include:
.Pp
.Bd -literal
#define MAPVIEW_EDIT		0x001	/* Mouse/keyboard edition */
#define MAPVIEW_INDEPENDENT	0x002	/* Zoom/ss independent from map */
#define MAPVIEW_TILESET		0x004	/* Map of source nodes */
#define MAPVIEW_GRID		0x008	/* Display a grid */
#define MAPVIEW_PROPS		0x010	/* Display node properties */
#define MAPVIEW_NO_CURSOR	0x100	/* Hide cursor */
.Ed
.Pp
The
.Dv MAPVIEW_EDIT
flag enables write operations on the map.
.Dv MAPVIEW_TILESET
allows nodes on this map to be selected as source nodes for level edition
operations.
The latter two flags are only available if the level editor,
.Xr mapedit 3 ,
is initialized.
.Pp
The
.Dv MAPVIEW_INDEPENDENT
flag enables the use of zoom factors and soft-scroll offsets that are
independent from the map's, but are not saved with
.Xr map
states.
.Pp
The
.Fn mapview_prescale
function arranges for the
.Nm
to reserve enough space to display
.Fa w
by
.Fa h
nodes at the initial sizing stage.
.Pp
The
.Fn mapview_center
function centers the view around the node at
.Fa x ,
.Fa y .
.Pp
The
.Fn mapview_zoom
function sets the scaling factor to
.Fa zoom ,
in % of the default tile geometry.
.Fn mapview_zoom
returns 0 on success and -1 on error.
.Sh SELECTIONS
.nr nS 1
.Ft void
.Fn mapview_set_selection "struct mapview *mv" "int x" "int y" \
                          "int w" "int h"
.Pp
.Ft int
.Fn mapview_get_selection "struct mapview *mv" "int *x" "int *y" \
                          "int *w" "int *h"
.Pp
.nr nS 0
The
.Fn mapview_set_selection
function sets the active selection to
.Fa w
by
.Fa h
nodes at map position
.Fa x ,
.Fa y .
.Fn mapview_set_selection
also disables any mouse selection in progress.
.Pp
The
.Fn mapview_get_selection
returns 1 if there is an active selection or 0 if there is none.
If there is no selection, no value is written to
.Fa x ,
.Fa y ,
.Fa w
and
.Fa h .
.Sh EVENTS
The
.Nm
widget reacts to the following events:
.Pp
.Bl -tag -width 25n
.It widget-lostfocus
Stop any zooming in progress.
.It window-mousebuttondown
The right mouse button enables scrolling.
The left mouse button invokes the current tool, if
.Dv MAPVIEW_EDIT
is set.
.It window-mousebuttonup
Stop scrolling or terminate a selection.
.It window-mousemotion
If the right mouse button is held, pan the view.
If a mouse selection is in progress, adjust the position relative to
the selection origin.
In edition mode, call current tool if the left mouse button is held,
or adjust the centering if the middle mouse button is held.
.It window-keydown
The default keys bindings are:
.Bl -tag -width "SDLK_EQUALS " -compact
.It Dv SDLK_EQUALS
Increment the zoom.
.It Dv SDLK_MINUS
Decrement the zoom.
.It Dv SDLK_[01]
Zoom to 1:1 (no scaling).
.It Dv SDLK_[2-9]
Zoom to a predefine value.
.It Dv SDLK_o
Center around the map origin.
.El
.It window-keyup
Stop any zooming in progress
.El
.Pp
The
.Nm
widget does not generate any event.
.Sh SEE ALSO
.Xr agar 3 ,
.Xr map 3 ,
.Xr mapedit 3 ,
.Xr widget 3 ,
.Xr window 3
.Sh HISTORY
The
.Nm
widget first appeared in Agar 1.0.
.Sh BUGS
The zoom uses unsafe SDL timers.
