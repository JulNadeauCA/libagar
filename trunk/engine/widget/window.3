.\"	$Csoft: window.3,v 1.48 2005/06/16 15:58:44 vedge Exp $
.\"
.\" Copyright (c) 2002, 2003, 2004, 2005 CubeSoft Communications, Inc.
.\" <http://www.csoft.org>
.\" All rights reserved.
.\"
.\" Redistribution and use in source and binary forms, with or without
.\" modification, are permitted provided that the following conditions
.\" are met:
.\" 1. Redistributions of source code must retain the above copyright
.\"    notice, this list of conditions and the following disclaimer.
.\" 2. Redistributions in binary form must reproduce the above copyright
.\"    notice, this list of conditions and the following disclaimer in the
.\"    documentation and/or other materials provided with the distribution.
.\" 
.\" THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR
.\" IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
.\" WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
.\" ARE DISCLAIMED. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT,
.\" INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
.\" (INCLUDING BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
.\" SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
.\" HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT,
.\" STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING
.\" IN ANY WAY OUT OF THE USE OF THIS SOFTWARE EVEN IF ADVISED OF THE
.\" POSSIBILITY OF SUCH DAMAGE.
.\"
.Dd August 21, 2002
.Dt WINDOW 3
.Os
.ds vT Agar API Reference
.ds oS Agar 1.0
.Sh NAME
.Nm window
.Nd agar window system
.Sh SYNOPSIS
.Bd -literal
#include <engine/widget/widget.h>
#include <engine/widget/window.h>
.Ed
.Sh DESCRIPTION
The
.Nm
object implements a mobile, resizable container for widgets; it is
itself derived from the
.Xr widget 3
structure and attached to a
.Xr view 3 .
Currently there is only one view; multiple views will be supported when
SDL implements multiple displays.
.Pp
The container behavior of a
.Nm
is much like a
.Xr vbox 3 .
Unless the
.Dv AG_WINDOW_NO_TITLEBAR
flag is set, a
.Xr titlebar 3
widget is attached to the window at creation time.
.Pp
Initially, the window's widgets are queried for a default, minimum size, and
the window is sized accordingly.
After this initial sizing, widget containers may scale widgets to any size.
.Sh INHERITANCE HIERARCHY
.Xr AG_Object 3 ->
.Xr widget 3 ->
.Nm .
.Sh INITIALIZATION
.nr nS 1
.Ft "AG_Window *"
.Fn AG_WindowNew "int flags" "const char *name" "..."
.Pp
.Ft "void"
.Fn AG_WindowInit "AG_Window *win" "const char *name" "int flags"
.Pp
.Ft "void"
.Fn AG_WindowSetCaption "AG_Window *win" "const char *fmt" "..."
.Pp
.Ft "void"
.Fn AG_WindowSetCloseAction "AG_Window *win" "int mode"
.Pp
.Ft "void"
.Fn AG_WindowSetPadding "AG_Window *win" "int xpadding" "int ypadding_top" "int ypadding_bot"
.Pp
.Ft "void"
.Fn AG_WindowSetSpacing "AG_Window *win" "int spacing"
.Pp
.Ft "void"
.Fn AG_WindowSetPosition "AG_Window *win, enum ag_window_alignment alignment" "int cascade"
.Pp
.Ft "void"
.Fn AG_WindowSetGeometry "AG_Window *win" "int x" "int y" "int w" "int h"
.Pp
.Ft void
.Fn AG_WindowAttach "AG_Window *win" "AG_Window *subwin"
.Pp
.Ft void
.Fn AG_WindowDetach "AG_Window *win" "AG_Window *subwin"
.nr nS 0
.Pp
The
.Fn AG_WindowNew
function allocates, initializes, and attaches a new window.
.Fn AG_WindowInit
initializes a
.Nm
structure.
.Pp
If the
.Fa name
argument is NULL, an unnamed window is created;
otherwise, a named window is created.
.Pp
If the name passed to
.Fn AG_WindowNew
matches an existing window, the focus is placed on the existing
window, no new window is created and the function returns NULL.
.Pp
Acceptable flags include:
.Bd -literal
#define AG_WINDOW_PERSISTENT	0x0001	/* Persistent position/geometry
				 	   (for named windows only) */
#define AG_WINDOW_CASCADE		0x0002	/* Increment position slightly */
#define AG_WINDOW_NO_TITLEBAR	0x0004	/* Disable the titlebar */
#define AG_WINDOW_NO_DECORATIONS	0x0008	/* Disable the window borders */
#define AG_WINDOW_HIDE		0x0010	/* Hide on window-close */
#define AG_WINDOW_DETACH		0x0020	/* Detach on window-close */
#define AG_WINDOW_MAXIMIZED	0x0040	/* Window is maximized */
#define AG_WINDOW_ICONIFIED	0x0080	/* Window is minimized */
#define AG_WINDOW_NO_HRESIZE	0x0100	/* Don't resize horizontally */
#define AG_WINDOW_NO_VRESIZE	0x0200	/* Don't resize vertically */
#define AG_WINDOW_NO_RESIZE	(AG_WINDOW_NO_HRESIZE|AG_WINDOW_NO_VRESIZE)
#define AG_WINDOW_NO_CLOSE_BTN	0x0400	/* Disable close button */
#define AG_WINDOW_NO_MINIMIZE_BTN	0x0800	/* Disable minimize button */
#define AG_WINDOW_NO_MAXIMIZE_BTN	0x1000	/* Disable maximize button */
.Ed
.Pp
The
.Fn AG_WindowSetCaption
function sets the text displayed by the titlebar (if there is one).
The string is truncated if its length exceeds
.Dv AG_LABEL_MAX
- 1 bytes.
.Pp
The
.Fn AG_WindowSetCloseAction
function changes the current
.Sq window-close
event handler to one of the predefined handlers:
.Bd -literal
#define AG_WINDOW_HIDE	0x0010	/* Hide on window-close */
#define AG_WINDOW_DETACH	0x0020	/* Detach on window-close */
.Ed
.Pp
The
.Fn AG_WindowSetPadding
function defines the space in pixels separating the widgets from the edges
of the window.
.Pp
The
.Fn AG_WindowSetSpacing
function defines the space separating the widgets from each other.
The default is 2 pixels.
.Pp
Note that
.fn AG_WindowSetSpacing
only affects the widgets which are directly attached to the window.
For widgets that are attached to container widgets, it is the container
widgets that define spacing, as well as other aspects of widget
organization.
For instance, the
.Xr box 3
container widget provides a
.Fn AG_BoxSetSpacing
function .
.Pp
The
.Fn AG_WindowSetPosition
function requests an initial window position, which may be one of:
.Bd -literal
enum ag_window_alignment {
	AG_WINDOW_UPPER_LEFT,
	AG_WINDOW_MIDDLE_LEFT,
	AG_WINDOW_LOWER_LEFT,
	AG_WINDOW_UPPER_RIGHT,
	AG_WINDOW_MIDDLE_RIGHT,
	AG_WINDOW_LOWER_RIGHT,
	AG_WINDOW_CENTER,
	AG_WINDOW_LOWER_CENTER,
	AG_WINDOW_UPPER_CENTER
};
.Ed
.Pp
If the
.Fa cascade
argument is 1, the window position is slightly incremented or decremented at
each call (depending on the preferred alignment).
.Pp
The
.Fn AG_WindowSetGeometry
function allows manual modification of a window's position and size in terms
of pixels.
It should be invoked after the window's child widgets are created, otherwise
no minimum geometry will be enforced when the window is later resized.
.Pp
Finally, the
.Fn AG_WindowAttach
function arranges for
.Fa pwin
to be the parent window of
.Fa win ,
such that
.Fa win
is automatically destroyed when
.Fa pwin
is detached (through
.Xr AG_ViewDetach 3 ) .
.Pp
The
.Fn AG_WindowDetach
function removes
.Fa win
from its parent window
.Fa pwin .
.Sh VISIBILITY
.nr nS 1
.Ft void
.Fn AG_WindowShow "AG_Window *win"
.Pp
.Ft void
.Fn AG_WindowHide "AG_Window *win"
.Pp
.Ft int
.Fn AG_WindowToggleVisibility "AG_Window *win"
.nr nS 0
.Pp
The
.Fn AG_WindowShow
function marks
.Fa win
as visible.
.Fn AG_WindowHide
marks
.Fa win
as invisible.
.Fn AG_WindowToggleVisibility
inverts the visibility state of
.Fa win .
.Sh GENERIC EVENT HANDLERS
.nr nS 1
.Ft void
.Fn AG_WindowDetachGenEv "int argc" "union evarg *argv"
.Pp
.Ft void
.Fn AG_WindowHideGenEv "int argc" "union evarg *argv"
.Pp
.Ft void
.Fn AG_WindowShowGenEv "int argc" "union evarg *argv"
.Pp
.Ft void
.Fn AG_WindowCloseGenEv "int argc" "union evarg *argv"
.nr nS 0
.Pp
The
.Fn AG_WindowDetachGenEv
event handler detaches the given window, freeing associated resources.
.Fn AG_WindowHideGenEv
hides the given window, if it is currently visible.
.Fn AG_WindowShowGenEv
invokes
.Fn AG_WindowShow
on the given window.
.Fn AG_WindowCloseGenEv
sends an
.Sq window-close
event to the given window.
A pointer to the window is passed as argument 1 to those event handlers.
.Pp
The
.Fn AG_WindowSetCloseAction
function is an alternative to assigning these event handlers manually.
.Sh EVENTS
The
.Nm
widget delivers the following events to its child widgets:
.Pp
.Bl -tag -width 2n
.It Fn window-mousemotion "int x" "int y" "int xrel" "int yrel" "int state"
The mouse cursor has moved to widget-relative coordinates
.Fa x
and
.Fa y
(which may be negative).
The
.Fa xrel
and
.Fa yrel
arguments represent the displacement relative to the last position of the
mouse cursor.
.Fa state
holds the present button state, as returned by
.Xr SDL_GetMouseState 3 .
Regardless of the mouse position, this event is posted to widgets that either
hold focus inside the focused window, or have the
.Dv AG_WIDGET_UNFOCUSED_MOTION
flag set.
.It Fn window-mousebuttonup "int button" "int x" "int y"
The mouse button indexed by
.Fa button
was released at widget-relative
.Fa x ,
.Fa y
coordinates.
Regardless of the mouse position, this event is posted to the widget that
holds focus inside the focused window.
.It Fn window-mousebuttondown "int button" "int x" "int y"
The mouse button indexed by
.Fa button
was pressed at widget-relative
.Fa x ,
.Fa y
coordinates, which must be inside the widget area.
.It Fn window-keyup "int keysym" "int keymod"
The key identified by
.Fa keysym
was released, and the widget holds the focus.
.It Fn window-keydown "int keysym" "int keymod" "int unicode"
The key identified by
.Fa keysym
was pressed, and the widget holds the focus.
.It Fn window-close "void"
The window's titlebar close button was pressed.
This event is generated after the window is no longer visible.
.It Fn window-shown "void"
The window is now visible.
.It Fn window-hidden "void"
The window is no longer visible.
.El
.Sh SEE ALSO
.Xr agar 3 ,
.Xr widget 3
.Sh HISTORY
The
.Nm
system first appeared in Agar 1.0.
